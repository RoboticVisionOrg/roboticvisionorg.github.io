<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>RV Panda Driver - ACRV</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-157261045-1', 'auto');
    ga('send', 'pageview');
    </script>
    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">ACRV</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Panda <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../panda_setup/">Setup</a>
</li>

                        
                            
<li class="active">
    <a href="./">RV Panda Driver</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../rv_manipulation_driver/">RV Manipulation Driver</a>
</li>

                        
                            
<li >
    <a href="../network_routing/">Network Routing</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../panda_setup/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../rv_manipulation_driver/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/roboticvisionorg/#/rv_panda_driver/README.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#qut-panda-driver">QUT Panda Driver</a></li>
            <li class="second-level"><a href="#overview">Overview</a></li>
                
            <li class="second-level"><a href="#usage">Usage</a></li>
                
                <li class="third-level"><a href="#launching-the-driver">Launching the driver</a></li>
                <li class="third-level"><a href="#moving-the-arm">Moving the arm</a></li>
                <li class="third-level"><a href="#managing-named-poses">Managing Named Poses</a></li>
                <li class="third-level"><a href="#subscribed-topics">Subscribed Topics</a></li>
                <li class="third-level"><a href="#published-topics">Published Topics</a></li>
                <li class="third-level"><a href="#services">Services</a></li>
                <li class="third-level"><a href="#action-api">Action API</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="qut-panda-driver">QUT Panda Driver</h1>
<h2 id="overview">Overview</h2>
<p>The Panda Driver provides a series of components for initalising and controlling the Franka-Emika Panda robotic arm.</p>
<p>This package provides a simplified interface for controlling the arm in in a variety of articulation modes by extending the <a href="https://github.com/roboticvisionorg/rv_manipulation_driver">RV Manipulation Driver</a> package.</p>
<h2 id="usage">Usage</h2>
<h3 id="launching-the-driver">Launching the driver</h3>
<p>The Panda Driver can be launched by executing the following command:</p>
<pre><code class="bash">roslaunch rv_panda_driver robot_bringup.launch
</code></pre>

<p>Other things to note when starting up the Panda:</p>
<ul>
<li>The lights indicate the status of the robot. <ul>
<li>Blue = happy and ready to move </li>
<li>White = happy but estopped</li>
<li>Yellow = error</li>
</ul>
</li>
<li>You will need to release the joint locks through the Franka interface</li>
<li>When operating the arm have the E-stop handy for safety at all times</li>
<li>When the arm is E-stopped it can be moved freely using the wrist switch </li>
</ul>
<p>To ensure the arm is working once started you can call the home routine. </p>
<pre><code class="bash">rosservice call /arm/home
</code></pre>

<h3 id="moving-the-arm">Moving the arm</h3>
<p>The Panda Driver provides a number of options for moving the robot arm. These include moving to fixed poses, as well as moving the arm by specifiying cartesian velocities for the end-effector.</p>
<h4 id="moving-the-end-effector-to-an-arbitrary-pose">Moving the End-Effector to an Arbitrary Pose</h4>
<p>The following code example moves the end-effector of the Panda robot to an arbitrary position and orientation w.r.t. to the robots base frame.</p>
<pre><code>import rospy
import actionlib

from rv_msgs.msg import MoveToPoseAction, MoveToPoseGoal
from geometry_msgs.msg import PoseStamped

# initialise ros node
rospy.init_node('move_to_points_example')

# Create a ros action client to communicate with the driver
client = actionlib.SimpleActionClient('/arm/cartesian/pose', MoveToPoseAction)
client.wait_for_server()

# Create a target pose
target = PoseStamped()
target.header.frame_id = 'panda_link0'

# Populate with target position/orientation (READY POSE)
target.pose.position.x = 0.307
target.pose.position.y = 0.000
target.pose.position.z = 0.590

target.pose.orientation.x = -1.00
target.pose.orientation.y =  0.00
target.pose.orientation.z =  0.00
target.pose.orientation.w =  0.00

# Create goal from target pose
goal = MoveToPoseGoal(goal_pose=target)

# Send goal and wait for it to finish
client.send_goal(goal)
client.wait_for_result()
</code></pre>

<h4 id="servoing-the-end-effector-to-an-arbitrary-pose">Servoing the End-Effector to an Arbitrary Pose</h4>
<p>The following code example servos the end-effector of the Panda robot to an arbitrary position and orientation w.r.t. to the robots base frame.</p>
<pre><code>import rospy
import actionlib

from rv_msgs.msg import ServoToPoseAction, ServoToPoseGoal
from geometry_msgs.msg import PoseStamped

# initialise ros node
rospy.init_node('servo_to_points_example')

# Create a ros action client to communicate with the driver
client = actionlib.SimpleActionClient('/arm/cartesian/servo_pose', ServoToPoseAction)
client.wait_for_server()

# Create a target pose
target = PoseStamped()
target.header.frame_id = 'panda_link0'

# Populate with target position/orientation (READY POSE)
target.pose.position.x = 0.307
target.pose.position.y = 0.000
target.pose.position.z = 0.590

target.pose.orientation.x = -1.00
target.pose.orientation.y =  0.00
target.pose.orientation.z =  0.00
target.pose.orientation.w =  0.00

# Create goal from target pose
goal = ServoToPoseGoal(stamped_pose=target, scaling=0.5)

# Send goal and wait for it to finish
client.send_goal(goal)
client.wait_for_result()
</code></pre>

<h4 id="moving-the-end-effector-in-cartesian-space">Moving the End-Effector in Cartesian Space</h4>
<p>The following code example moves the arm at 2cm a second in the z-axis of the base-frame for 5 seconds. For safety reasons the driver has an expected minimum frequency of 100Hz.</p>
<pre><code>import rospy
import timeit
from geometry_msgs.msg import TwistStamped

# initialise ros node
rospy.init_node('cartesian_motion')

# Create the publisher (queue size tells ROS to only publish the latest message)
publisher = rospy.Publisher('/arm/cartesian/velocity', TwistStamped, queue_size=1)

# Create an initial start time
start = timeit.default_timer()

# Create a velocity message that will instruct the robot to move at 2cm a second in the z-axis of the base frame.
velocity = TwistStamped()
velocity.twist.linear.z = 0.02

# Publish the velocity message to the panda driver at a frequency of 100Hz
while (timeit.default_timer() - start) &lt; 5:
  publisher.publish(velocity)
  rospy.sleep(0.01)

# Publish an empty TwistStamped to ensure that the arm stops moving
publisher.publish(TwistStamped())
</code></pre>

<h3 id="managing-named-poses">Managing Named Poses</h3>
<p>While the MoveIt framework provide the ability to store joint configurations as named poses, these must be defined in the MoveIt configuration of the robot and cannot be adjusted during operation. </p>
<p>The panda driver solves this issue by providing the ability to save and remember joint configurations of the Panda arm for future, while also providing access to named poses provided by moveit.</p>
<h4 id="saving-named-poses">Saving Named Poses</h4>
<p>The following command demonstrates how to the current joint configuration of the robot with the name <em>test_pose</em>:</p>
<pre><code>rosservice call /arm/set_named_pose &quot;pose_name: 'test_pose' overwrite: false&quot;
</code></pre>

<h4 id="getting-named-poses">Getting Named Poses</h4>
<p>The following command demonstrates how to get the current set of stored named poses (created either through the driver or moveit)</p>
<pre><code>rosservice call /arm/get_named_poses
</code></pre>

<h4 id="moving-to-a-named-pose">Moving to a Named Pose</h4>
<p>The following code example demonstrates how to move to a named pose:</p>
<pre><code>import rospy
import actionlib

from rv_msgs.msg import MoveToNamedPoseAction, MoveToNamedPoseGoal

# initialise ros node
rospy.init_node('named_pose_example')

# Create a ros action client to communicate with the driver
client = actionlib.SimpleActionClient('/arm/cartesian/named_pose', MoveToNamedPoseAction)
client.wait_for_server()

# Create and send a goal to move to the named pose test_pose
client.send_goal(MoveToNamedPoseGoal(pose_name='test_pose'))
client.wait_for_result()
</code></pre>

<p><strong>Note:</strong> The goal pose can be a named pose created either by the driver or moveit. However, the named poses provided by the driver will take priority in the event of a naming conflict.</p>
<h3 id="subscribed-topics">Subscribed Topics</h3>
<ul>
<li>
<p><strong>/arm/cartesian/velocity</strong> (<a href="https://docs.ros.org/api/geometry_msgs/html/msg/Twist.html">geometry_msgs/TwistStamped</a>)
Moves the end-effector in cartesian space w.r.t. the target frame_id (base frame if no frame_id is set).</p>
</li>
<li>
<p><strong>/arm/joint/velocity</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/msg/JointVelocity.html">rv_msgs/JointVelocity</a>)
Moves the joints of the manipulator at the requested velocity.</p>
</li>
</ul>
<h3 id="published-topics">Published Topics</h3>
<ul>
<li><strong>/arm/state</strong>  (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/msg/ManipulatorState.msg">rv_msgs/ManipulatorState</a>)
Provides information on the current state of the manipulator including the pose of the end-effector w.r.t. to the base link, whether the manipulator is experiencing a cartesian contact and collision as a bit-wised error state flag.</li>
</ul>
<h3 id="services">Services</h3>
<ul>
<li>
<p><strong>/arm/home</strong> (<a href="http://docs.ros.org/jade/api/std_srvs/html/srv/Empty.html">std_srvs/Empty</a>)
Moves the robot back to its initial ready pose.</p>
</li>
<li>
<p><strong>/arm/recover</strong> (<a href="http://docs.ros.org/jade/api/std_srvs/html/srv/Empty.html">std_srvs/Empty</a>)
Recovers from collision or limit violation error states that will put the robot into a non-operable state.</p>
</li>
<li>
<p><strong>/arm/stop</strong> (<a href="http://docs.ros.org/jade/api/std_srvs/html/srv/Empty.html">std_srvs/Empty</a>)
Stops the current motion of the current.</p>
</li>
<li>
<p><strong>/arm/set_ee_offset</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/SetPose.srv">rv_msgs/SetPose</a>)
Sets the offset between the end-effector and the wrist of the robot arm.</p>
</li>
<li>
<p><strong>/arm/get_named_poses</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/GetNamesList.srv">rv_msgs/GetNamesList</a>)
Gets a list of currently stored named poses (includes both moveit and driver stored named poses).</p>
</li>
<li>
<p><strong>/arm/set_named_pose</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/SetNamedPose.srv">rv_msgs/SetNamedPose</a>)
Saves the current joint configuration of the panda with the provided pose name.</p>
</li>
<li>
<p><strong>/arm/set_cartesian_impedance</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/SetCartesianImpedance.srv">rv_msgs/SetCartesianImpedance</a>
Adjusts the impedenace of the end-effector position in cartesian space.</p>
</li>
<li>
<p><strong>/arm/get_link_position</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/GetRelativePose.srv">rv_msgs/GetRelativePose</a>)
A convenience wrapper around the ROS transform lookup service that provides the relative pose of a target frame w.r.t. a reference frame.</p>
</li>
<li>
<p><strong>/arm/set_cartesian_planning_enabled</strong> (<a href="http://docs.ros.org/jade/api/std_srvs/html/srv/SetBool.html">std_srvs/SetBool</a>)
Forces the path-planner to only consider linear paths when moving moving between poses with /arm/cartesian/pose</p>
</li>
<li>
<p><strong>/arm/get_cartesian_planning_enabled</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/SimpleRequest.srv">rv_msgs/SimpleRequest</a>)
Checks whether the path-planner will only consider linear paths when moving moving between poses with /arm/cartesian/pose</p>
</li>
<li>
<p><strong>/arm/add_named_pose_config</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/SetNamedPoseConfig.srv">rv_msgs/SetNamedPoseConfig</a>)
Instructs the driver to load named poses stored in the indicated config file.</p>
</li>
<li>
<p><strong>/arm/get_named_pose_configs</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/GetNamedPoseConfigs.srv">rv_msgs/GetNamedPoseConfigs</a>)
Gets the list of config files to check for named poses.</p>
</li>
<li>
<p><strong>/arm/remove_named_pose_config</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/srv/SetNamedPoseConfig.srv">rv_msgs/SetNamedPoseConfig</a>)
Instructs the driver to remove named poses stored in the indicated config file.</p>
</li>
</ul>
<h3 id="action-api">Action API</h3>
<ul>
<li>
<p><strong>/arm/cartesian/pose</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/action/MoveToPose.action">rv_msgs/MoveToPose.action</a>)
Moves the end-effector to the requested goal pose w.r.t. the indicated frame id.</p>
</li>
<li>
<p><strong>/arm/cartesian/servo_pose</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/action/ServoToPose.action">rv_msgs/ServoToPose.action</a>)
Servos the end-effector to the requested goal pose.</p>
</li>
<li>
<p><strong>/arm/cartesian/named_pose</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/action/MoveToNamedPose.action">rv_msgs/MoveToNamedPose.action</a>)
Moves the end-effector to a pre-defined joint configuration.</p>
</li>
<li>
<p><strong>/arm/cartesian/servo_pose</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/action/MoveToJointPose.action">rv_msgs/MoveToJointPoseAction</a>)
Moves the joints of the robot to the indicated positions (radians).</p>
</li>
<li>
<p><strong>/arm/gripper</strong> (<a href="https://github.com/roboticvisionorg/rv_msgs/blob/master/action/ActuateGripper.action">rv_msgs/ActuateGripper.action</a>)
Actuates the gripper based on the requested mode. The static mode will move the gripper to the requested width. The grasp mode will attempt to grasp an object of width plus/minus a tolernace factor.</p>
</li>
</ul></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
        </p>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    
    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
